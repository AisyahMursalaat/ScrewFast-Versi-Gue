---
import MainLayout from "@/layouts/MainLayout.astro";
---

<MainLayout title="Admin Dashboard | RentHeavyPro">
Â  <div class="mx-auto max-w-[85rem] px-4 py-10 sm:px-6 lg:px-8">
Â  Â Â 
Â  Â  <div class="mb-8 flex flex-col sm:flex-row justify-between items-center gap-4 border-b border-gray-200 dark:border-neutral-700 pb-6">
Â  Â  Â  <div>
Â  Â  Â  Â  <h1 class="text-3xl font-bold text-gray-800 dark:text-white">Admin Dashboard</h1>
Â  Â  Â  Â  <p class="text-gray-500 mt-1">Database Status: <span class="text-green-600 font-bold">â— Terhubung (sdb_rent)</span></p>
Â  Â  Â  </div>
Â  Â  Â  <button id="logoutBtn" class="bg-red-600 text-white px-4 py-2 rounded-lg font-bold text-sm hover:bg-red-700 transition">Logout</button>
Â  Â  </div>

Â  Â  <div class="flex space-x-4 mb-6 overflow-x-auto pb-2">
Â  Â  Â  <button onclick="switchTab('orders')" id="tabOrders" class="px-6 py-3 rounded-lg font-bold bg-white shadow text-orange-600 border border-orange-200 transition whitespace-nowrap">ğŸ“‹ Verifikasi Order</button>
Â  Â  Â  <button onclick="switchTab('products')" id="tabProducts" class="px-6 py-3 rounded-lg font-bold text-gray-500 hover:bg-gray-100 transition whitespace-nowrap">ğŸ“¦ Kelola Unit</button>
Â  Â  Â  <button onclick="switchTab('gps')" id="tabGPS" class="px-6 py-3 rounded-lg font-bold text-gray-500 hover:bg-gray-100 transition whitespace-nowrap">ğŸ“¡ GPS Tracking</button>
Â  Â  </div>

Â  Â  <div id="panelOrders" class="space-y-6">
Â  Â  Â  Â <div class="bg-white p-6 rounded-xl shadow border dark:bg-neutral-900 dark:border-neutral-700">
Â  Â  Â  Â  Â  <div class="flex justify-between items-center mb-4">
Â  Â  Â  Â  Â  Â  Â  <h3 class="font-bold text-lg text-gray-800 dark:text-white">Antrian Pesanan Masuk</h3>
Â  Â  Â  Â  Â  Â  Â  <button onclick="fetchOrders()" class="text-blue-600 text-sm hover:underline flex items-center gap-1">ğŸ”„ Refresh Data</button>
Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  <div id="orderList" class="space-y-4">
Â  Â  Â  Â  Â  Â  Â  <p class="text-center py-10 text-gray-400">Memuat data pesanan...</p>
Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â </div>
Â  Â  </div>

Â  Â  <div id="panelProducts" class="hidden space-y-6">
Â  Â  Â  Â <div class="bg-orange-50 p-6 rounded-xl border border-orange-200 dark:bg-neutral-800 dark:border-neutral-700">
Â  Â  Â  Â  Â  <h3 class="font-bold text-lg mb-4 text-orange-800 dark:text-orange-400">â• Tambah Unit Baru</h3>
<form id="addProductForm" class="grid grid-cols-1 md:grid-cols-2 gap-4">
Â  Â  Â  Â  Â  Â  Â <input type="text" id="pName" placeholder="Nama Unit" class="border p-2 rounded w-full" required>
Â  Â  Â  Â  Â  Â  Â <select id="pCategory" class="border p-2 rounded w-full bg-white" required>
Â  Â  Â  Â  Â  Â  Â  Â  <option value="" disabled selected>Pilih Kategori</option>
Â  Â  Â  Â  Â  Â  Â  Â  <option value="Heavy">Heavy Duty (Berat)</option>
Â  Â  Â  Â  Â  Â  Â  Â  <option value="Light">Light Duty (Ringan)</option>
Â  Â  Â  Â  Â  Â  Â </select>
Â  Â  Â  Â  Â  Â  Â <input type="number" id="pPrice" placeholder="Harga Sewa Harian" class="border p-2 rounded w-full" required>
Â  Â  Â  Â  Â  Â  Â <input type="number" id="pStock" placeholder="Stok Awal" class="border p-2 rounded w-full" required>
Â  Â  Â  Â  Â  Â  Â <input type="text" id="pImage" placeholder="Emoji (ğŸšœ) atau URL Gambar" class="border p-2 rounded w-full" required>
Â  Â  Â  Â  Â  Â  Â <textarea id="pDesc" class="md:col-span-2 border p-2 rounded w-full" placeholder="Deskripsi unit..." rows="2"></textarea>
Â  Â  Â  Â  Â  Â  Â <button type="submit" class="md:col-span-2 bg-orange-600 text-white font-bold py-2 rounded hover:bg-orange-700 transition">Simpan ke Database</button>
Â  Â  Â  Â  Â  </form>
Â  Â  Â  Â </div>

Â  Â  Â  Â <div class="bg-white p-6 rounded-xl shadow border dark:bg-neutral-900 dark:border-neutral-700 overflow-x-auto">
Â  Â  Â  Â  Â  <h3 class="font-bold mb-4 text-gray-800 dark:text-white">Daftar Unit di Database</h3>
Â  Â  Â  Â  Â  <table class="w-full text-sm text-left text-gray-600 dark:text-gray-400">
Â  Â  <thead class="bg-gray-100 dark:bg-neutral-800 uppercase text-xs">
Â  Â  Â  Â  Â  Â  Â  Â  <tr><th class="p-3 rounded-tl-lg">Unit</th><th class="p-3">Kategori</th><th class="p-3">Harga/Hari</th><th class="p-3">Stok</th><th class="p-3 rounded-tr-lg">ID</th></tr>
Â  Â  Â  Â  Â  Â  Â </thead>
Â  Â  Â  Â  Â  Â  Â <tbody id="productListBody"></tbody>
Â  Â  Â  Â  Â  </table>
Â  Â  Â  Â </div>
Â  Â  </div>

Â  Â  <div id="panelGPS" class="hidden">
Â  Â  Â  Â <div class="bg-gray-900 text-white p-6 rounded-xl shadow-lg h-[500px] relative overflow-hidden flex items-center justify-center group">
Â  Â  Â  Â  Â  <div class="absolute inset-0 opacity-30" style="background-image: radial-gradient(circle, #4ade80 1px, transparent 1px); background-size: 40px 40px;"></div>
Â  Â  Â  Â  Â  <div class="absolute top-4 right-4 text-xs font-mono text-green-400 border border-green-400 p-2 rounded bg-black/50 z-10">
Â  Â  Â  Â  Â  Â  Â  SYSTEM: ONLINE<br>LATENCY: 24ms
Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  <div class="absolute top-1/4 left-1/4 text-4xl animate-bounce cursor-pointer group-hover:scale-110 transition" title="Excavator #204">
Â  Â  Â  Â  Â  Â  Â ğŸšœ <span class="text-[10px] bg-black px-1 rounded block text-center -mt-8">Active</span>
Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  <div class="absolute bottom-1/3 right-1/3 text-4xl animate-pulse cursor-pointer group-hover:scale-110 transition" title="Crane #05">
Â  Â  Â  Â  Â  Â  Â ğŸ—ï¸ <span class="text-[10px] bg-black px-1 rounded block text-center -mt-8">Idle</span>
Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  <div class="absolute bottom-6 left-6 text-sm font-mono bg-black/50 p-3 rounded border border-gray-700 z-10">
Â  Â  Â  Â  Â  Â  Â <p class="text-green-400">>> Tracking Unit #204 (Excavator PC200)</p>
Â  Â  Â  Â  Â  Â  Â <p class="text-gray-300">Location: -6.2088, 106.8456 (Jakarta Project A)</p>
Â  Â  Â  Â  Â  Â  Â <p class="text-gray-300">Speed: 0 km/h (Working)</p>
Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â </div>
Â  Â  </div>

Â  Â  <div id="verifyModal" class="fixed inset-0 z-50 hidden bg-black/80 flex items-center justify-center p-4">
Â  Â  Â  Â <div class="bg-white w-full max-w-md rounded-xl p-6 text-center shadow-2xl transform transition-all scale-100">
Â  Â  Â  Â  Â  <h3 class="font-bold text-xl mb-2 text-gray-800">Verifikasi Dokumen Legalitas</h3>
Â  Â  Â  Â  Â  <p class="text-sm text-gray-500 mb-4">Pastikan SIM/SIO valid dan sesuai nama penyewa.</p>
Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  <div class="my-6 border-2 border-dashed border-blue-300 bg-blue-50 p-6 rounded-lg hover:bg-blue-100 transition">
Â  Â  Â  Â  Â  Â  Â  <p class="text-sm text-gray-500 mb-2">File Uploaded:</p>
Â  Â  Â  Â  Â  Â  Â  <div class="text-5xl mb-2">ğŸ“„</div>
Â  Â  Â  Â  Â  Â  Â  <a id="docLink" href="#" target="_blank" class="text-blue-600 font-bold underline text-lg break-all hover:text-blue-800">
Â  Â  Â  Â  Â  Â  Â  Â  Â Lihat Dokumen Asli
Â  Â  Â  Â  Â  Â  Â  </a>
Â  Â  Â  Â  Â  Â  Â  <p class="text-xs text-gray-400 mt-2">*Klik link untuk membuka gambar/PDF</p>
Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  <div class="grid grid-cols-2 gap-3">
Â  Â  Â  Â  Â  Â  Â <button onclick="updateStatus('rejected')" class="bg-red-100 text-red-600 font-bold py-3 rounded-lg hover:bg-red-200 transition border border-red-200">
Â  Â  Â  Â  Â  Â  Â  Â  âŒ Tolak
Â  Â  Â  Â  Â  Â  Â </button>
Â  Â  Â  Â  Â  Â  Â <button onclick="updateStatus('active')" class="bg-green-600 text-white font-bold py-3 rounded-lg hover:bg-green-700 transition shadow-lg">
Â  Â  Â  Â  Â  Â  Â  Â  âœ… Approve & Aktifkan
Â  Â  Â  Â  Â  Â  Â </button>
Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  <button onclick="closeModal()" class="mt-4 text-sm text-gray-500 hover:text-gray-800 underline">Tutup</button>
Â  Â  Â  Â </div>
Â  Â  </div>

Â  </div>

Â  <script>
Â  Â  const API_URL = 'http://localhost:5000/api';
Â  Â  const UPLOAD_URL = 'http://localhost:5000/uploads';
Â  Â Â 
Â  Â  let allOrders = []; // Variabel untuk menyimpan data order dari DB
Â  Â  let selectedOrderId = null;

// --- NAVIGASI TAB ---
Â  Â  window.switchTab = (tabName) => {
Â  Â  Â  Â  ['orders', 'products', 'gps'].forEach(t => {
Â  Â  Â  Â  Â  Â  // PERBAIKAN: Jika t adalah 'gps', gunakan 'GPS', jika tidak, gunakan kapitalisasi huruf pertama ('Orders', 'Products')
Â  Â  Â  Â  Â  Â  const idPart = t === 'gps' ? 'GPS' : t.charAt(0).toUpperCase() + t.slice(1);
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  // Deactivate panels
Â  Â  Â  Â  Â  Â  const panel = document.getElementById(`panel${idPart}`);
Â  Â  Â  Â  Â  Â  if (panel) panel.classList.add('hidden'); // Menambah null check untuk keamanan

Â  Â  Â  Â  Â  Â  // Deactivate buttons
Â  Â  Â  Â  Â  Â  const btn = document.getElementById(`tab${idPart}`);
Â  Â  Â  Â  Â  Â  if (btn) { // Menambah null check untuk keamanan
Â  Â  Â  Â  Â  Â  Â  Â  btn.classList.remove('bg-white', 'shadow', 'text-orange-600', 'border', 'border-orange-200');
Â  Â  Â  Â  Â  Â  Â  Â  btn.classList.add('text-gray-500', 'hover:bg-gray-100');
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  });
Â  Â  Â  Â Â 
Â  Â  Â  Â  // Tentukan ID yang benar untuk tab yang diaktifkan
Â  Â  Â  Â  const activeIdPart = tabName === 'gps' ? 'GPS' : tabName.charAt(0).toUpperCase() + tabName.slice(1);

Â  Â  Â  Â  // Activate the new tab and panel
Â  Â  Â  Â  const activePanel = document.getElementById(`panel${activeIdPart}`);
Â  Â  Â  Â  if (activePanel) activePanel.classList.remove('hidden');

Â  Â  Â  Â  const activeBtn = document.getElementById(`tab${activeIdPart}`);
Â  Â  Â  Â  if (activeBtn) {
Â  Â  Â  Â  Â  Â  activeBtn.classList.add('bg-white', 'shadow', 'text-orange-600', 'border', 'border-orange-200');
Â  Â  Â  Â  Â  Â  activeBtn.classList.remove('text-gray-500', 'hover:bg-gray-100');
Â  Â  Â  Â  }

Â  Â  Â  Â  if(tabName === 'orders') fetchOrders();
Â  Â  Â  Â  if(tabName === 'products') fetchProducts();
Â  Â  };

Â  Â  // --- 1. FETCH ORDERS (PB-09) ---
Â  Â  async function fetchOrders() {
Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  Â  const res = await fetch(`${API_URL}/orders`);
Â  Â  Â  Â  Â  Â  allOrders = await res.json(); // Simpan ke variabel global
Â  Â  Â  Â  Â  Â  const list = document.getElementById('orderList');
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  if(allOrders.length === 0) { list.innerHTML = '<p class="text-center text-gray-400 py-4">Belum ada pesanan masuk.</p>'; return; }

Â  Â  Â  Â  Â  Â  list.innerHTML = allOrders.map(o => {
Â  Â  Â  Â  Â  Â  Â  Â  let statusBadge = '';
Â  Â  Â  Â  Â  Â  Â  Â  let actionBtn = '';

Â  Â  Â  Â  Â  Â  Â  Â  if(o.status === 'pending_verification') {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  statusBadge = `<span class="bg-yellow-100 text-yellow-800 px-2 py-1 rounded text-xs font-bold border border-yellow-200">â³ Menunggu Verifikasi</span>`;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  actionBtn = `<button onclick="openVerifyModal('${o.order_id}', '${o.ktp_sim_image}')" class="bg-blue-600 text-white px-4 py-2 rounded-lg text-sm font-bold hover:bg-blue-700 shadow-sm transition flex items-center gap-1">ğŸ” Verifikasi</button>`;
Â  Â  Â  Â  Â  Â  Â  Â  } else if(o.status === 'active') {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  statusBadge = `<span class="bg-green-100 text-green-800 px-2 py-1 rounded text-xs font-bold border border-green-200">âœ… Aktif / Dikirim</span>`;
Â  Â  Â  Â  Â  Â  Â  Â  } else if(o.status === 'rejected') {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  statusBadge = `<span class="bg-red-100 text-red-800 px-2 py-1 rounded text-xs font-bold border border-red-200">âŒ Ditolak</span>`;
Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â  return `
Â  Â  Â  Â  Â  Â  Â  Â  <div class="border p-5 rounded-xl bg-white hover:shadow-md transition flex flex-col md:flex-row justify-between items-start md:items-center gap-4 border-l-4 ${o.status.includes('pending') ? 'border-l-yellow-400' : o.status === 'active' ? 'border-l-green-500' : 'border-l-gray-200'}">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="flex-1">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="flex items-center gap-2">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p class="font-bold text-gray-800 text-lg">${o.customer_name}</p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="text-[10px] bg-gray-100 px-2 py-0.5 rounded text-gray-500 font-mono border">${o.order_id}</span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p class="text-sm text-gray-600 mt-1">Unit: <b>${o.item_name || 'Alat Berat'}</b> â€¢ Durasi: ${o.duration}</p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p class="text-xs text-gray-500 mt-1 flex items-center gap-1">ğŸ“ ${o.project_loc}</p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="mt-2">${statusBadge}</div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="text-right w-full md:w-auto flex flex-row md:flex-col justify-between items-center md:items-end">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p class="font-bold text-orange-600 text-xl">Rp ${parseInt(o.total_rental_fee).toLocaleString()}</p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="mt-0 md:mt-3">${actionBtn}</div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  </div>`;
Â  Â  Â  Â  Â  Â  }).join('');
Â  Â  Â  Â  } catch (e) {
Â  Â  Â  Â  Â  Â  console.error(e);
Â  Â  Â  Â  Â  Â  document.getElementById('orderList').innerHTML = '<p class="text-red-500 text-center">Gagal mengambil data dari Server Backend (Port 5000).</p>';
Â  Â  Â  Â  }
Â  Â  }

Â  Â  // --- 2. FETCH PRODUCTS (PB-10) ---
Â  Â  async function fetchProducts() {
Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  Â  const res = await fetch(`${API_URL}/products`);
Â  Â  Â  Â  Â  Â  const data = await res.json();
Â  Â  Â  Â  Â  Â  const tbody = document.getElementById('productListBody');
Â  Â  Â  Â  Â  Â  tbody.innerHTML = data.map(p => `
Â  Â  Â  Â  Â  Â  Â  Â  <tr class="border-b hover:bg-gray-50 transition dark:border-neutral-700">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <td class="p-3 font-bold flex items-center gap-2 dark:text-white">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="text-xl">${p.image && p.image.length < 5 ? p.image : 'ğŸ“·'}</span> ${p.name}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </td>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <td class="p-3 font-bold text-xs ${p.category === 'Heavy' ? 'text-red-600' : 'text-blue-600'}">${p.category || 'Heavy'}</td>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <td class="p-3 dark:text-gray-300">Rp ${parseInt(p.price).toLocaleString()}</td>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <td class="p-3 font-mono dark:text-gray-300">${p.stock}</td>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <td class="p-3 text-gray-400 text-xs">#${p.id}</td>
Â  Â  Â  Â  Â  Â  Â  Â  </tr>
Â  Â  Â  Â  Â  Â  `).join('');
Â  Â  Â  Â  } catch (e) { console.error(e); }
Â  Â  }

Â  Â  // --- 3. CRUD LOGIC ---

Â  Â  // PB-10: Tambah Produk
Â  Â  document.getElementById('addProductForm').addEventListener('submit', async (e) => {
Â  Â  Â  Â  e.preventDefault();
Â  Â  Â  Â  const body = {
Â  Â  Â  Â  Â  Â  name: document.getElementById('pName').value,
Â  Â  Â  Â  Â  Â  category: document.getElementById('pCategory').value,
Â  Â  Â  Â  Â  Â  price: document.getElementById('pPrice').value,
Â  Â  Â  Â  Â  Â  stock: document.getElementById('pStock').value,
Â  Â  Â  Â  Â  Â  image: document.getElementById('pImage').value,
Â  Â  Â  Â  Â  Â  description: document.getElementById('pDesc').value
Â  Â  Â  Â  };

Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  Â  const res = await fetch(`${API_URL}/products`, {
Â  Â  Â  Â  Â  Â  Â  Â  method: 'POST',
Â  Â  Â  Â  Â  Â  Â  Â  headers: { 'Content-Type': 'application/json' },
Â  Â  Â  Â  Â  Â  Â  Â  body: JSON.stringify(body)
Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  if(res.ok) {
Â  Â  Â  Â  Â  Â  Â  Â  alert('âœ… Produk Berhasil Disimpan ke MySQL!');
Â  Â  Â  Â  Â  Â  Â  Â  e.target.reset();
Â  Â  Â  Â  Â  Â  Â  Â  fetchProducts();
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  } catch (e) { alert('Gagal simpan: ' + e); }
Â  Â  });

Â  Â  // PB-09: Verifikasi Dokumen & Update Status
Â  Â  window.openVerifyModal = (orderId, docImage) => {
Â  Â  Â  Â  selectedOrderId = orderId;
Â  Â  Â  Â  const link = document.getElementById('docLink');
Â  Â  Â  Â Â 
Â  Â  Â  Â  if (docImage && docImage !== 'null' && docImage !== 'undefined') {
Â  Â  Â  Â  Â  Â  link.href = `${UPLOAD_URL}/${docImage}`;
Â  Â  Â  Â  Â  Â  link.innerText = `Lihat Dokumen (${docImage})`;
Â  Â  Â  Â  Â  Â  link.classList.remove('pointer-events-none', 'text-gray-400');
Â  Â  Â  Â  Â  Â  link.classList.add('text-blue-600', 'underline');
Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  link.href = "#";
Â  Â  Â  Â  Â  Â  link.innerText = "Tidak ada file dokumen";
Â  Â  Â  Â  Â  Â  link.classList.add('pointer-events-none', 'text-gray-400');
Â  Â  Â  Â  Â  Â  link.classList.remove('text-blue-600', 'underline');
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  document.getElementById('verifyModal').classList.remove('hidden');
Â  Â  };

Â  Â  window.closeModal = () => document.getElementById('verifyModal').classList.add('hidden');

Â  Â  window.updateStatus = async (status) => {
Â  Â  Â  Â  if(!selectedOrderId) return;
Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  Â  // KIRIM PERUBAHAN STATUS KE BACKEND
Â  Â  Â  Â  Â  Â  await fetch(`${API_URL}/orders/${selectedOrderId}`, {Â 
Â  Â  Â  Â  Â  Â  Â  Â  method: 'PUT',Â 
Â  Â  Â  Â  Â  Â  Â  Â  headers: { 'Content-Type': 'application/json' },Â 
Â  Â  Â  Â  Â  Â  Â  Â  body: JSON.stringify({ status })Â 
Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  // PB-13: Simulasi Notifikasi ke User (Opsional: Tambah Notif di sini)
Â  Â  Â  Â  Â  Â  alert(`Notifikasi Terkirim: Status pesanan ${selectedOrderId} diubah menjadi ${status.toUpperCase()}`);

Â  Â  Â  Â  Â  Â  // Close Modal dan Refresh List (Membuat Status Langsung Berubah di List)
Â  Â  Â  Â  Â  Â  closeModal();
Â  Â  Â  Â  Â  Â  fetchOrders();Â 
Â  Â  Â  Â  } catch (e) { alert('Error update status: ' + e); }
Â  Â  };

Â  Â  // --- INIT ---
Â  Â  // Cek Login Admin
Â  Â  const role = localStorage.getItem('userRole');
Â  Â  if(localStorage.getItem('isLoggedIn') !== 'true' || role !== 'admin') {
Â  Â  Â  Â  alert('Akses Ditolak. Halaman ini khusus Admin.');
Â  Â  Â  Â  window.location.href = '/login';
Â  Â  }
Â  Â Â 
Â  Â  document.getElementById('logoutBtn').onclick = () => {Â 
Â  Â  Â  Â localStorage.clear();Â 
Â  Â  Â  Â window.location.href = '/login';Â 
Â  Â  };
Â  Â Â 
Â  Â  // Load First Tab
Â  Â  fetchOrders();
Â  </script>
</MainLayout>